<form [formGroup]="findingsRulesForm">
    <div class="row p-3">
        <div class="col-md-9 col-9">
            <h5 *ngIf="isRuleEdit === true || isNew">Add New Rule </h5>
            <mat-form-field *ngIf="isGetNewRule && !isRuleEdit && !isNew " style="max-width:300px"
                matTooltip="Example : Choose an option from the drop down" [matTooltipPosition]="tooltipPosition">
                <mat-label>Select Rule</mat-label>
                <mat-select (selectionChange)="onChangeRule($event)" [(value)]="selectedRule">
                    <mat-option style="color: rgb(9, 2, 2);" *ngFor="let rule of findingsRulesList"
                        [value]="rule.findingRuleId">
                        {{rule.name}}
                    </mat-option>
                </mat-select>
                <!-- <mat-error *ngIf="findingsRulesForm.controls['rules'].invalid">rule required
            </mat-error> -->
            </mat-form-field>
        </div>
  
        <div class="col-lg-3">
            <div id="editIcon">
                <div>
                    <!-- <button class="" (click)="openAddRule(assignedContactNameLists)" mat-raised-button color="primary"
                        *ngIf=" !isRuleEdit">Add
                        New
                        Rule</button> -->
                    <button class="" mat-raised-button color="primary" *ngIf=" !isRuleEdit" (click)="addNewRuleSetup()">
                        Add New Rule Setup</button>

                    <button class="" (click)="onfindingsRulesFormSubmit()" mat-raised-button color="primary"
                        *ngIf=" isRuleEdit===true && !isNew">Save</button>

                    <button mat-button color="primary" (click)="editFindingRuleList()"
                        *ngIf="isRuleEdit===false && !isNew">
                        <mat-icon color="accent" style="font-size: 20px;" class="ft-size">edit</mat-icon>Edit
                    </button>
                    <button *ngIf=" isRuleEdit ===true" (click)="cancelFindingRuleList()" class="mt-n1" mat-button
                        color="primary">
                        <mat-icon color="accent" class="ft-size">cancel</mat-icon>Cancel
                    </button>
                </div>
            </div>
        </div>
        <!-- <div class="row" style="margin-left:0px" *ngIf="isRuleEdit === true || isNew ">
            <div class="col-md-6">

                <mat-form-field matTooltip="Name" [matTooltipPosition]="tooltipPosition" class="full-width">
                    <mat-label>Name</mat-label>
                    <input autocomplete="off" matInput placeholder="Name" formControlName="name" required>
                    <mat-error *ngIf="findingsRulesForm.controls['name']?.errors?.required">name required</mat-error>
                </mat-form-field>
            </div>
            <div class="col-md-4">
                <mat-slide-toggle [labelPosition]="myLabelPosition" formControlName="activeInactive" [checked]="recStat1 === true ? true : false"
                    (change)="recStat1 = !recStat1">
                    {{ recStat1 ? "Active" : "Inactive" }}
                </mat-slide-toggle>
            </div>
        </div>                 -->
    </div>

    <mat-card style="border: 1px solid #ddd; box-shadow:none ">
        <div class="row" style="margin-left:0px" *ngIf="isRuleEdit === true || isNew ">
            <div class="col-md-6">

                <mat-form-field matTooltip="Name" [matTooltipPosition]="tooltipPosition" class="full-width">
                    <mat-label>Name</mat-label>
                    <input autocomplete="off" matInput placeholder="Name" formControlName="name" required>
                    <mat-error *ngIf="findingsRulesForm.controls['name']?.errors?.required">name required</mat-error>
                </mat-form-field>
            </div>
            <div class="col-md-4 mt-2">
                <mat-slide-toggle [labelPosition]="myLabelPosition" [disabled]="!isRuleEdit"
                    formControlName="activeInactive" [checked]="recStat1 === true ? true : false"
                    (change)="recStat1 = !recStat1">
                    {{ recStat1 ? "Active" : "Inactive" }}
                </mat-slide-toggle>
            </div>
        </div>
        <div class="row p-1 " style="margin-left:0px" *ngIf="isGetSelectedRule == true && findingRuleResultData.length > 0">
            <div class="col-md-4 float-right">
                <h6> {{ selectedRuleName }}</h6>
            </div>
            <div class="col-md-2 float-right">
                <mat-slide-toggle [labelPosition]="myLabelPosition" [disabled]="!isRuleEdit"
                    [checked]="recStat1 === true ? true : false" (change)="recStat1 = !recStat1">
                    {{ recStat1 ? "Active" : "Inactive" }}
                </mat-slide-toggle>
            </div>
            <!-- <div class="col-md-1 ms-4 mt-1 float-right" *ngIf="isRuleEdit || isNew">
                <button (click)="openAddRule(assignedContactNameLists)" class="mt-1" mat-button color="primary">
                    <mat-icon color="accent">add</mat-icon>Add
                </button>
            </div> -->
        </div>

        <form [formGroup]="updateFindingRuleForm" (ngSubmit)="onSubmit()" autocomplete="off" class="user-form">
            <div class="row p-3">
                <div class="col col-md-12">
                    <!-- <div class="d-flex justify-content-start" *ngIf="isRuleEdit===false">
                        <h5>Rules</h5>                     
                    </div> -->
                    <div class="d-flex mr-2" *ngIf="isRuleEdit===true">
                        <button mat-icon-button (click)="openAddRule(null)" matTooltip="Add rule" [matTooltipPosition]="tooltipPosition">
                            Rules<mat-icon aria-hidden="true" style="color:green">library_add
                            </mat-icon>
                        </button>
                    </div>
                    <!-- <div *ngIf="findingRuleResultData.length===0 " style="opacity: 0.5;padding-left:10px"> No data to
                        dispaly</div> -->
                  
                    <table mat-table  [dataSource]="dataSource" class="mt-2" matSort>
                        <!--- Note that these columns can be defined in any order.
                            The actual rendered columns are set as a property on the row definition" -->

                        <!-- group Column -->
                        <ng-container matColumnDef="group">
                            <th mat-header-cell *matHeaderCellDef>Group</th>
                            <td mat-cell *matCellDef="let element">
                              
                                <mat-slide-toggle [disabled]="!isFindingRuleEdit" [labelPosition]="myLabelPosition1"
                                    [checked]="element.groupId===0"(change)="recStat = !recStat">
                                    <!-- {{ recStat ? "Active" : "Inactive" }} -->
                                  
                                </mat-slide-toggle>
                            </td>
                        </ng-container>

                        <!-- andOr Column -->
                        <ng-container matColumnDef="andOr">
                            <th mat-header-cell *matHeaderCellDef>And/Or</th>
                            <!-- <td mat-cell *matCellDef="let element">{{element.name}}</td> -->
                            <td mat-cell *matCellDef="let element">
                                <mat-form-field class="w-100 mt-2" appearance="outline">
                               
                                    <mat-label>Choose</mat-label>
                                    <mat-select [disabled]="!isRuleEdit"
                                        [(value)]="element.andOr">
                                        <mat-option *ngFor="let selectedValue of andOrList"
                                            [value]="selectedValue.item_id">
                                            {{selectedValue.item_text}}
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </td>
                        </ng-container>

                        <!-- Form/Questionnaire Column -->
                        <ng-container matColumnDef="formQuestionnaire">
                            <th mat-header-cell *matHeaderCellDef>Form/Questionnaire</th>
                            <td mat-cell *matCellDef="let element">
                                <mat-form-field class="w-100 mt-2" appearance="outline">
                                    <mat-label>Choose</mat-label>
                                    <mat-select [disabled]="!isRuleEdit" 
                                        [(value)]="element.sourceType"
                                        (selectionChange)="formQuestMethod($event.value,element)">
                                        <mat-option *ngFor="let formQuestionnaireData of formQuestionnaireList"
                                            [value]="formQuestionnaireData.item_id">
                                            {{formQuestionnaireData.item_text}}
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>
                                <mat-form-field class="w-100 mt-2" appearance="outline" 
                                    *ngIf="element.sourceType == 'FORM'">
                                 
                                    <mat-label>Choose</mat-label>
                                    <mat-select [disabled]="!isRuleEdit"
                                        (selectionChange)="getFieldMethod(element.sourceType,$event.value,element)"
                                        [(value)]="element.flexFormPdftemplateId">
                                        <mat-option *ngFor="let selectedValue of _arrSelectedFormList"
                                            [value]="selectedValue.id">
                                            {{selectedValue.name}}
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>
                                <mat-form-field class="w-100 mt-2" appearance="outline"
                                    *ngIf="element.sourceType == 'QUESTIONNAIRE'">
                                    <mat-label>Choose</mat-label>
                                    <mat-select [disabled]="!isRuleEdit" 
                                        (selectionChange)="getFieldMethod(element.sourceType,$event.value,element)"
                                        [(value)]="element.questionnaireId">
                                        <mat-option *ngFor="let selectedValue of _arrSelectedQuestList"
                                            [value]="selectedValue.id">
                                            {{selectedValue.name}}
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>
                                <mat-form-field class="w-100 mt-2" appearance="outline"
                                    *ngIf="element.sourceType == 'FORM'">
                                
                                    <mat-label>Choose</mat-label>
                                    <mat-select [disabled]="!isRuleEdit" 
                                        (selectionChange)="getOperator($event.value,element)"
                                        [(value)]="element.flexFormPdftemplateFieldId">
                                        <mat-option *ngFor="let fieldvalue of fieldListData" [value]="fieldvalue.id">
                                            {{fieldvalue.fieldName}}
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>
                                <mat-form-field class="w-100 mt-2" appearance="outline"
                                    *ngIf="element.sourceType == 'QUESTIONNAIRE'">
                                    <mat-label>Choose</mat-label>
                                    {{fieldListQuesData | json}} - {{element.questionnaireFieldId}}
                                    <mat-select [disabled]="!isRuleEdit" 
                                        (selectionChange)="getOperator($event.value,element)"
                                        [(value)]="element.questionnaireFieldId">
                                        <mat-option *ngFor="let fieldvalue of fieldListQuesData" [value]="fieldvalue.id">
                                            {{fieldvalue.fieldName}}
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </td>
                        </ng-container>

                        <!-- Operator Column -->
                        <ng-container matColumnDef="operator">
                            <th mat-header-cell *matHeaderCellDef>Operator</th>
                            <!-- <td mat-cell *matCellDef="let element">{{element.fieldType}}</td> -->
                            <td mat-cell *matCellDef="let element">
                                <mat-form-field class="w-100 mt-2" appearance="outline"
                                    *ngIf="element.sourceType == 'FORM'">
                                    <mat-label>Choose</mat-label>
                                    {{element.operator}} -- {{operatorList | json}}
                                    <mat-select [disabled]="!isRuleEdit" 
                                        [(value)]="element.operator">
                                        <mat-option *ngFor="let operatorvalue of operatorList"
                                            [value]="operatorvalue.item_id">
                                            {{operatorvalue.item_text}}
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>
                                <mat-form-field class="w-100 mt-2" appearance="outline"
                                    *ngIf="element.sourceType == 'QUESTIONNAIRE'">
                                    <mat-label>Choose</mat-label>
                                    <mat-select [disabled]="!isRuleEdit" 
                                        [(value)]="element.operator">
                                        <mat-option *ngFor="let operatorvalue of operatorList"
                                            [value]="operatorvalue.item_id">
                                            {{operatorvalue.item_text}}
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </td>
                        </ng-container>

                        <!-- Value Column -->
                        <ng-container matColumnDef="value">
                            <th mat-header-cell *matHeaderCellDef>Value</th>
                            <td mat-cell *matCellDef="let element">
                                <mat-form-field class="w-100 mt-2" appearance="outline">
                                    <mat-label>Choose</mat-label>
                                    <mat-select [disabled]="!isRuleEdit" 
                                        (selectionChange)="formTextQuestMethod($event.value,element)" [(value)]="element.valueType">
                                        <mat-option *ngFor="let formQuestionnaireData of formTextQuestionnaireList"
                                            [value]="formQuestionnaireData.item_id">
                                            {{formQuestionnaireData.item_text}}
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>
                                <mat-form-field class="w-100 mt-2" appearance="outline"
                                    *ngIf="element.valueType == 'FORM'">
                                     <mat-label>Choose</mat-label>
                                    <mat-select [disabled]="!isRuleEdit" 
                                        (selectionChange)="getValueFieldMethod(element.valueType,$event.value,element)"
                                        [(value)]="element.flexFormPdftemplateIdValue">
                                        <mat-option *ngFor="let selectedValue of _arrSelectedValueFormList"
                                            [value]="selectedValue.id">
                                            {{selectedValue.name}}
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>
                                <mat-form-field class="w-100 mt-2" appearance="outline"
                                    *ngIf="element.valueType == 'QUESTIONNAIRE'">
                                    <mat-label>Choose</mat-label>
                                    <mat-select [disabled]="!isRuleEdit" 
                                        (selectionChange)="getValueFieldMethod(element.valueType,$event.value,element)"
                                        [(value)]="element.questionnaireIdValue">
                                        <mat-option *ngFor="let selectedValue of _arrSelectedValueQuestList"
                                            [value]="selectedValue.id">
                                            {{selectedValue.name}}
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>
                                <mat-form-field class="w-100 mt-2" appearance="outline" *ngIf="element.valueType == 'FORM'">
                                    <mat-label>Choose</mat-label>
                                    <mat-select [disabled]="!isRuleEdit" 
                                        [(value)]="element.flexFormPdftemplateFieldIdValue">
                                        <mat-option *ngFor="let fieldvalue of fieldValueListData"
                                            [value]="fieldvalue.id">
                                            {{fieldvalue.fieldName}}
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>
                                <mat-form-field class="w-100 mt-2" appearance="outline"
                                    *ngIf="element.valueType == 'QUESTIONNAIRE'">
                                    <mat-label>Choose</mat-label>
                                    <mat-select [disabled]="!isRuleEdit" 
                                        [(value)]="element.questionnaireFieldIdValue">
                                        <mat-option *ngFor="let fieldvalue of fieldValueListData"
                                            [value]="fieldvalue.id">
                                            {{fieldvalue.fieldName}}
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>
                                <mat-form-field class="w-100 mt-2" appearance="outline"
                                    *ngIf="element.valueType == 'TEXT'">
                                    <textarea matInput [disabled]="!isRuleEdit"
                                    [value]='element.valueText'></textarea>
                                    <!-- {{element.valueText}} -->
                                </mat-form-field>
                            </td>
                        </ng-container>

                        <!-- Action Column -->
                        <!-- <ng-container matColumnDef="Action">
                            <th mat-header-cell *matHeaderCellDef style="width:5%"> </th>
                            <td mat-cell *matCellDef="let element" class="text-center">
                                <div class="row">
                                    <button mat-button color="primary" (click)="openAddRule(element)">
                                        <mat-icon color="accent">mode_edit</mat-icon>
                                    </button>
                                    <button mat-button color="primary">
                                        <mat-icon color="accent">delete</mat-icon>
                                    </button>
                                </div>
                            </td>
                        </ng-container> -->

                        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                    </table>
                    <table class="mt-2 opacity-record">
                        <tr *ngIf="findingRuleResultData.length===0">
                          <td style="text-align: center;" [attr.colspan]="displayedColumns.length">
                            No Records Found!
                          </td>
                        </tr>
                      </table>
                    <!-- <div *ngIf="findingRuleResultData.length===0" class="no-records">
                        No records found!
                      </div> -->
                </div>
            </div>

        </form>


        <div class="row p-3 mt-2">
            <div class="col-md-12">
                <div class="d-flex">
                    <div class="mt-2">Findings </div>
                    <div>
                        <button mat-icon-button (click)="openAddFinding(assignedContactNameLists)" matTooltip="Add findings" [matTooltipPosition]="tooltipPosition">
                            <mat-icon style="color:green" *ngIf="isRuleEdit===true">library_add</mat-icon>
                        </button>
                    </div>
                </div>
                <div *ngIf="!getFindingRuleArcData " class="opacity-record"> No data to dispaly</div>
            </div>
        </div>

        <div class="row p-3" *ngIf="getFindingRuleArcData">
            <div class="col-md-10">
                <div class="d-flex flex-column">
                    <div class="row">
                        <div class="mt-2 col-md-3">Citation </div>
                        <div class="mt-2 col-md-2">: </div>
                        <!-- <div class="mt-2 col-md-5" *ngIf=" !isGetCitationData">
                            No Findings
                        </div> -->
                        <div class="mt-2 col-md-5">
                            <!-- <mat-form-field class="w-100 mt-2" appearance="outline">
                            <mat-select [disabled]="!isFindingRuleEdit"
                                [(value)]="getFindingRuleArcData.citId">
                                <mat-option *ngFor="let citationvalue of _arrFindingArc"
                                    [value]="citationvalue.citId">
                                    {{citationvalue.citation}}
                                </mat-option>
                            </mat-select>
                        </mat-form-field> -->
                            {{getFindingRuleArcData?.citation}}
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="mt-2 col-md-3">Finding </div>
                        <div class="mt-2 col-md-2">: </div>
                        <!-- <div class="mt-2 col-md-5" *ngIf=" !isGetFindingData">
                            No Findings
                        </div> -->
                        <div class="mt-2 col-md-5">
                            {{getFindingRuleArcData?.findings}}
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="mt-2 col-md-3">ARC </div>
                        <div class="mt-2 col-md-2">: </div>
                        <!-- <div class="mt-2 col-md-5" *ngIf=" !isGetARCData">
                            No Findings
                        </div> -->
                        <div class="mt-2 col-md-5">
                            {{getFindingRuleArcData?.ARC}}
                        </div>
                    </div>
                </div>
            </div>

        </div>

    </mat-card>
</form>